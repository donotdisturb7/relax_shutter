import{o as i,c as d,b as o,a as u,e as v,u as a,i as P,f as k,t as f,d as g,D as Q,j as y,h as _,C as J,H as K,Q as W,r as $,T as X,x as F,g as ee,n as x,E as te,F as se,k as oe}from"./app-BI7OEea5.js";import{Y as le,h as L,G as re,V as ae,r as z,S as ne}from"./transition-CYIWtLHr.js";function ie(s,n){return i(),d("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[o("path",{"fill-rule":"evenodd",d:"M9.53 2.47a.75.75 0 0 1 0 1.06L4.81 8.25H15a6.75 6.75 0 0 1 0 13.5h-3a.75.75 0 0 1 0-1.5h3a5.25 5.25 0 1 0 0-10.5H4.81l4.72 4.72a.75.75 0 1 1-1.06 1.06l-6-6a.75.75 0 0 1 0-1.06l6-6a.75.75 0 0 1 1.06 0Z","clip-rule":"evenodd"})])}function T(s,n){return i(),d("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[o("path",{"fill-rule":"evenodd",d:"M18.97 3.659a2.25 2.25 0 0 0-3.182 0l-10.94 10.94a3.75 3.75 0 1 0 5.304 5.303l7.693-7.693a.75.75 0 0 1 1.06 1.06l-7.693 7.693a5.25 5.25 0 1 1-7.424-7.424l10.939-10.94a3.75 3.75 0 1 1 5.303 5.304L9.097 18.835l-.008.008-.007.007-.002.002-.003.002A2.25 2.25 0 0 1 5.91 15.66l7.81-7.81a.75.75 0 0 1 1.061 1.06l-7.81 7.81a.75.75 0 0 0 1.054 1.068L18.97 6.84a2.25 2.25 0 0 0 0-3.182Z","clip-rule":"evenodd"})])}const de={class:"flex items-center gap-2"},ue=["src"],ce={class:"flex items-center font-bold"},fe={key:0,class:"text-gray-400"},me={__name:"PostUserHeader",props:{post:{type:Object},showTime:{type:Boolean,default:!0}},setup(s){return(n,c)=>(i(),d("div",de,[u(a(P),{href:n.route("profile",s.post.user.username)},{default:v(()=>[o("img",{src:s.post.user.avatar_url,class:"w-[40px] rounded-full border border-2 transition-all hover:border-blue-500"},null,8,ue)]),_:1},8,["href"]),o("div",null,[o("h4",ce,[u(a(P),{href:n.route("profile",s.post.user.username),class:"hover:underline"},{default:v(()=>[k(f(s.post.user.name),1)]),_:1},8,["href"])]),s.showTime?(i(),d("small",fe,f(s.post.updated_at),1)):g("",!0)])]))}},U=s=>{let n=s.mime||s.type;return n=n.split("/"),n[0].toLowerCase()==="image"},He=s=>{let n=s.mime||s.type;return n=n.split("/"),n[0].toLowerCase()==="video"},H=Q.create();H.interceptors.request.use(function(s){return s});const pe=["href"],he=["src","alt"],ve={class:"p-2 dark:text-gray-900"},be={class:"font-semibold"},ge={class:"text-sm m-none"},we=["href"],xe={class:"p-2"},ye={__name:"UrlPreview",props:{preview:Object,url:String},setup(s){return(n,c)=>s.preview&&s.preview.title?(i(),d("a",{key:0,href:s.url,target:"_blank",class:"block mt-4 border border-indigo-200 bg-indigo-50"},[o("img",{src:s.preview.image,class:"max-w-full",alt:s.preview.title},null,8,he),o("div",ve,[o("h3",be,f(s.preview.title),1),o("p",ge,f(s.preview.description),1)])],8,pe)):s.url?(i(),d("a",{key:1,href:s.url,target:"_blank",class:"block mt-4 border border-indigo-200 bg-indigo-50"},[o("div",xe,f(s.url),1)],8,we)):g("",!0)}},ke={class:"fixed inset-0 overflow-y-auto"},_e={class:"flex min-h-full items-center justify-center p-4 text-center"},Ve={__name:"BaseModal",props:{title:{type:String,required:!1},modelValue:Boolean},emits:["update:modelValue","hide"],setup(s,{emit:n}){const c=s,w=y({get:()=>c.modelValue,set:p=>m("update:modelValue",p)}),m=n;function b(){w.value=!1,m("hide")}return(p,l)=>(i(),_(K,{to:"body"},[u(a(ne),{appear:"",show:w.value,as:"template"},{default:v(()=>[u(a(le),{as:"div",onClose:b,class:"relative z-50"},{default:v(()=>[u(a(L),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:v(()=>l[0]||(l[0]=[o("div",{class:"fixed inset-0 bg-black/25"},null,-1)])),_:1}),o("div",ke,[o("div",_e,[u(a(L),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:v(()=>[u(a(re),{class:"w-full max-w-md transform overflow-hidden rounded bg-white dark:bg-slate-900 text-left align-middle shadow-xl transition-all"},{default:v(()=>[s.title?(i(),_(a(ae),{key:0,as:"h3",class:"flex items-center justify-between py-3 px-4 font-medium bg-gray-100 dark:bg-slate-800 text-gray-900 dark:text-gray-100"},{default:v(()=>[k(f(s.title)+" ",1),o("button",{onClick:b,class:"w-8 h-8 rounded-full hover:bg-black/5 dark:hover:bg-black/30 transition flex items-center justify-center"},[u(a(z),{class:"w-4 h-4"})])]),_:1})):g("",!0),J(p.$slots,"default")]),_:3})]),_:3})])])]),_:3})]),_:3},8,["show"])]))}},Ce={class:"p-4"},$e={key:0,class:"border-l-4 border-amber-500 py-2 px-3 bg-amber-100 mt-3 text-gray-800 rounded"},je={key:1,class:"border-l-4 border-red-500 py-2 px-3 bg-red-100 mt-3 text-gray-800 rounded"},Ee={class:"text-red-500"},Se={key:0,class:"absolute z-10 left-0 bottom-0 right-0 py-2 px-3 text-sm bg-black/75 text-white flex justify-between items-center"},Be=["onClick"],Me=["src"],Pe={class:"text-center"},Le={class:"text-red-500"},Te={class:"flex justify-end items-center pt-4"},qe={__name:"PostModal",props:{post:{type:Object,required:!0},modelValue:Boolean},emits:["update:modelValue","hide"],setup(s,{emit:n}){const c=s,w=W().props.attachmentExtensions||[];w.length||console.warn("attachmentExtensions is undefined or empty.");const m=$([]),b=$([]),p=$({}),l=X({body:"",attachments:[],deleted_file_ids:[],preview:{},preview_url:null,_method:"POST"}),V=y({get:()=>c.modelValue,set:e=>S("update:modelValue",e)}),j=y(()=>[...m.value,...c.post.attachments||[]]),E=y(()=>{for(let e of m.value){let h=e.file.name.split(".").pop().toLowerCase();if(!w.includes(h))return!0}return!1}),S=n;F(()=>c.post,()=>{l.body=c.post.body||"",M()});function C(){V.value=!1,S("hide"),q()}function q(){l.reset(),p.value={},m.value=[],b.value=[],c.post.attachments&&c.post.attachments.forEach(e=>e.deleted=!1)}function A(){l.attachments=m.value.map(e=>e.file),c.post.id?(l._method="PUT",l.post(route("post.update",c.post.id),{preserveScroll:!0,onSuccess:e=>{C()},onError:e=>{B(e)}})):l.post(route("post.create"),{preserveScroll:!0,onSuccess:e=>{C()},onError:e=>{B(e)}})}function B(e){p.value=e;for(const t in e)if(t.includes(".")){const[,r]=t.split(".");b.value[r]=e[t]}}async function D(e){for(const t of e.target.files){const r={file:t,url:await N(t)};m.value.push(r)}e.target.value=null}async function N(e){return new Promise((t,r)=>{if(U(e)){const h=new FileReader;h.onload=()=>{t(h.result)},h.onerror=r,h.readAsDataURL(e)}else t(null)})}function O(e){e.file?m.value=m.value.filter(t=>t!==e):(l.deleted_file_ids.push(e.id),e.deleted=!0)}function R(e){e.deleted=!1,l.deleted_file_ids=l.deleted_file_ids.filter(t=>e.id!==t)}function I(e){e!==l.preview_url&&(l.preview_url=e,l.preview={},e&&H.post(route("post.fetchUrlPreview"),{url:e}).then(({data:t})=>{l.preview={title:t["og:title"],description:t["og:description"],image:t["og:image"]}}).catch(t=>{console.log(t)}))}function M(){let e=G();e||(e=Y()),I(e)}function G(){const e=/<a.+href="((https?):\/\/[^"]+)"/,t=l.body.match(e);return t&&t.length>0?t[1]:null}function Y(){const e=/(?:https?):\/\/[^\s<]+/,t=l.body.match(e);return t&&t.length>0?t[0]:null}return(e,t)=>(i(),_(Ve,{title:s.post.id?"Modifier le post":"Créer un post",modelValue:V.value,"onUpdate:modelValue":t[2]||(t[2]=r=>V.value=r),onHide:C},{default:v(()=>[o("div",Ce,[u(me,{post:s.post,"show-time":!1,class:"mb-4"},null,8,["post"]),E.value?(i(),d("div",$e,[t[3]||(t[3]=k(" Extensions de fichiers autorisées : ")),t[4]||(t[4]=o("br",null,null,-1)),o("small",null,f(a(w).join(", ")),1)])):g("",!0),p.value.attachments?(i(),d("div",je,f(p.value.attachments),1)):g("",!0),ee(o("textarea",{class:x(["w-full px-3 py-2 border rounded-lg resize-none mt-4 focus:ring-2 focus:ring-sky-500 focus:border-sky-500",p.value.body?"border-red-500":""]),rows:"3",placeholder:"Partagez vos pensées...","onUpdate:modelValue":t[0]||(t[0]=r=>a(l).body=r),onInput:M},null,34),[[te,a(l).body]]),o("small",Ee,f(p.value.body),1),a(l).preview_url?(i(),_(ye,{key:2,modelValue:a(l).preview,"onUpdate:modelValue":t[1]||(t[1]=r=>a(l).preview=r)},null,8,["modelValue"])):g("",!0),o("div",{class:x(["grid gap-3 my-3",[j.value.length===1?"grid-cols-1":"grid-cols-2"]])},[(i(!0),d(se,null,oe(j.value,(r,h)=>(i(),d("div",{key:h},[o("div",{class:x(["group aspect-square bg-gray-50 flex flex-col items-center justify-center text-gray-500 relative border rounded-lg overflow-hidden",b.value[h]?"border-red-500":""])},[r.deleted?(i(),d("div",Se,[t[5]||(t[5]=k(" À supprimer ")),u(a(ie),{onClick:Z=>R(r),class:"w-4 h-4 cursor-pointer hover:text-sky-400"},null,8,["onClick"])])):g("",!0),o("button",{onClick:Z=>O(r),class:"absolute z-20 right-2 top-2 w-7 h-7 flex items-center justify-center bg-black/50 text-white rounded-full hover:bg-black/75 transition-colors"},[u(a(z),{class:"h-5 w-5"})],8,Be),a(U)(r.file||r)?(i(),d("img",{key:1,src:r.url,class:x(["object-contain aspect-square",r.deleted?"opacity-50":""])},null,10,Me)):(i(),d("div",{key:2,class:x(["flex flex-col justify-center items-center px-3",r.deleted?"opacity-50":""])},[u(a(T),{class:"w-10 h-10 mb-3"}),o("small",Pe,f((r.file||r).name),1)],2))],2),o("small",Le,f(b.value[h]),1)]))),128))],2),o("label",{class:x(["relative w-full mb-4 border-2 border-dashed rounded-lg text-center p-4 block hover:border-sky-500 hover:bg-sky-50 transition-colors cursor-pointer",E.value?"border-amber-500":""])},[o("input",{class:"absolute inset-0 w-full h-full z-10 opacity-0 cursor-pointer",type:"file",multiple:"",onChange:D},null,32),u(a(T),{class:"h-6 w-6 mx-auto text-gray-400"}),t[6]||(t[6]=o("span",{class:"block text-gray-500 mt-2"},"Ajouter des photos ou fichiers",-1))],2),o("div",Te,[o("button",{onClick:A,type:"button",class:"bg-sky-500 hover:bg-sky-600 text-white rounded-lg py-2 px-4 font-medium transition-colors"},f(s.post.id?"Mettre à jour":"Publier"),1)])])]),_:1},8,["title","modelValue"]))}};export{qe as _,He as a,H as b,me as c,ye as d,U as i,T as r};
